(this["webpackJsonphomebridge-ui"]=this["webpackJsonphomebridge-ui"]||[]).push([[0],{22:function(e,t,r){"use strict";r.r(t);var n=r(13),c=r.n(n),o=r(2),s=r.n(o),a=r(12),i=r(15),u=r(14),f=r(5),p=r(6),d=r(0),m=(r(11),r(1)),h=window.homebridge;function l(e){var t=e.onRefreshToken,r=Object(d.useState)(!1),n=Object(p.a)(r,2),c=n[0],o=n[1],a=Object(d.useState)(),i=Object(p.a)(a,2),u=i[0],l=i[1];return Object(d.useEffect)((function(){c?h.showSpinner():h.hideSpinner()}),[c]),Object(d.useEffect)((function(){if(u){var e=h.createForm({schema:{type:"object",properties:{code:{title:"Code",type:"string",required:!0,description:u.codePrompt}}}},{},"Link Account","Change Email");e.onSubmit(function(){var e=Object(f.a)(s.a.mark((function e(r){var n,c,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.code,o(!0),e.prev=2,e.next=5,h.request("/token",{email:u.email,password:u.password,code:n});case 5:c=e.sent,a=c.refreshToken,t(a),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),h.toast.error(e.t0.message,"Failed to Link Account");case 14:return e.prev=14,o(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,10,14,17]])})));return function(t){return e.apply(this,arguments)}}()),e.onCancel((function(){return l(void 0)}))}else{h.createForm({schema:{type:"object",properties:{email:{title:"Email",type:"string","x-schema-form":{type:"email"},required:!0},password:{title:"Password",type:"string","x-schema-form":{type:"password"},required:!0}}}},{},"Log In").onSubmit(function(){var e=Object(f.a)(s.a.mark((function e(r){var n,c,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.email,c=r.password,o(!0),e.next=4,new Promise((function(e){return setTimeout(e,1e3)}));case 4:return e.prev=4,e.next=7,h.request("/send-code",{email:n,password:c});case 7:"refreshToken"in(a=e.sent)?t(a.refreshToken):l({email:n,password:c,codePrompt:a.codePrompt}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error(e.t0),h.toast.error(e.t0.message,"Ring Login Failed");case 15:return e.prev=15,o(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])})));return function(t){return e.apply(this,arguments)}}())}}),[t,u]),Object(m.jsx)("h4",{className:"text-center primary-text mb-3",children:"Link Ring Account"})}var b=window.homebridge;function j(){return b.getPluginConfig()}function w(){var e=Object(d.useState)(!1),t=Object(p.a)(e,2),r=t[0],n=t[1];function c(){return(c=Object(f.a)(s.a.mark((function e(t){var r,c,o,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:return r=e.sent,c=Object(u.a)(r),o=c[0],f=c.slice(1),e.next=8,b.updatePluginConfig([Object(a.a)(Object(a.a)({},o),{},{refreshToken:t})].concat(Object(i.a)(f)));case 8:b.toast.success("Refresh Token Updated","Ring Login Successful"),n(!1);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(d.useEffect)((function(){r?b.hideSchemaForm():b.showSchemaForm()}),[r]),Object(d.useEffect)((function(){j().then((function(e){var t,r=!(null===(t=e[0])||void 0===t?void 0:t.refreshToken);n(r)})).catch((function(e){return console.error(e)}))}),[]),r?Object(m.jsx)(l,{onRefreshToken:function(e){return c.apply(this,arguments)}}):Object(m.jsxs)("button",{className:"btn btn-link m-0 p-0",onClick:function(){return n(!0)},children:[Object(m.jsx)("i",{className:"fa fa-redo mr-2"}),"Generate New Refresh Token"]})}window.homebridge.addEventListener("ready",(function(){c.a.render(Object(m.jsx)(w,{}),document.getElementById("root"))}))}},[[22,1,2]]]);
//# sourceMappingURL=main.adeecae1.chunk.js.map